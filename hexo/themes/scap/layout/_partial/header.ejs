<link rel="stylesheet" href="<%= url_for('css/nav.css') %>">
<header>
  <div class="logo"></div>
  <nav>
    <ul>
      <% site.data.header.menu.forEach((item, index) => { %>
        <li>
          <a href="<%= item.link ? url_for(item.link) : '#' %>" <%= item.active ? 'class="active"' : '' %>><%= item.text %></a>
          <% if (item.submenus) { %>
            <div class="submenu">
              <div class="submenu-content">
                <% item.submenus.forEach(sub => { %>
                  <div class="submenu-column">
                    <h3><%= sub.title %></h3>
                    <ul>
                      <% sub.items.forEach(subItem => { %>
                        <li><a href="<%= url_for(subItem.link) %>"><%= subItem.text %></a></li>
                      <% }) %>
                    </ul>
                  </div>
                <% }) %>
              </div>
            </div>
            <div class="blur-overlay"></div>
          <% } %>
        </li>
      <% }) %>
    </ul>
  </nav>
  <div class="icons">
    <button class="mobile-menu-toggle" aria-label="Toggle menu">☰</button>
  </div>
</header>
<div class="overlay" id="overlay"></div>
<div class="mobile-menu" id="mobile-menu">
  <ul class="mobile-list">
    <% site.data.header.menu.forEach((item, index) => { 
         const hasSub = !!item.submenus;
         const idBase = (item.text || '').toLowerCase().replace(/\s+/g, '-'); // 仅把空白转-
    %>
      <li class="<%= hasSub ? 'has-submenu' : '' %>">
        <a href="<%= item.link ? url_for(item.link) : '#' %>" 
           class="mobile-link <%= item.active ? 'active' : '' %>">
          <%= item.text %>
        </a>

        <% if (hasSub) { %>
          <button
            type="button"
            class="submenu-toggle"
            aria-controls="<%= idBase %>-submenu"
            aria-expanded="false"
            aria-label="Toggle <%= item.text %> submenu"
            onclick="toggleMobileSubmenu(event, '<%= idBase %>-submenu')">
            <svg class="chevron" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M6 9l6 6 6-6"></path>
            </svg>
          </button>

          <!-- 如果担心 id 非法，可把上面两处和这里的 id 改成 menu-<%= index %>-submenu -->
          <div id="<%= idBase %>-submenu" class="mobile-submenu">
            <% item.submenus.forEach(sub => { %>
              <div class="mobile-submenu-section">
                <h3><%= sub.title %></h3>
                <ul>
                  <% sub.items.forEach(subItem => { %>
                    <li><a href="<%= url_for(subItem.link) %>"><%= subItem.text %></a></li>
                  <% }) %>
                </ul>
              </div>
            <% }) %>
          </div>
        <% } %>
      </li>
    <% }) %>
  </ul>
</div>


 <script src="<%= url_for('js/nav.js') %>"></script>