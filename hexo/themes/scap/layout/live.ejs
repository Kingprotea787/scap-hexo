<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">
  <title>直播间 - <%= config.title || 'SCAP' %></title>
  <link rel="stylesheet" href="<%= url_for('css/live.css') %>">
</head>
<body>
  <%- partial('_partial/header') %>

  <main class="live-container">
    <!-- 左侧：视频区域 -->
    <div class="live-main">
      <div class="video-wrapper" id="videoWrapper">
        <!-- 视频选择界面 -->
        <div class="video-selector" id="videoSelector">
          <h3>选择视频</h3>
          <div class="video-grid" id="videoGrid">
            <!-- 视频列表会动态插入 -->
          </div>
        </div>
        <!-- 视频播放器 -->
        <video id="liveVideo" class="live-video" playsinline webkit-playsinline style="display: none;">
          您的浏览器不支持视频播放
        </video>
        <button class="fullscreen-btn" id="fullscreenBtn" aria-label="全屏" style="display: none;">
          <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
            <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
          </svg>
        </button>
        <!-- 返回选择按钮 -->
        <button class="back-btn" id="backBtn" aria-label="返回选择" style="display: none;">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H8V4h12v12z"/>
          </svg>
        </button>
        <!-- 弹幕层 -->
        <div class="danmaku-layer" id="danmakuLayer"></div>
      </div>

      <!-- 输入框 -->
      <div class="chat-input-area">
        <button class="mic-btn" id="micBtn" title="开启麦克风">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5zm6 6c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
          </svg>
        </button>
        <button class="mute-btn" id="muteBtn" title="静音（不接收他人语音）">
          <svg class="mute-icon" viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
          </svg>
          <svg class="mute-slash" viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M3.63 3.63a.996.996 0 000 1.41L7.29 8.7 7 9H3v6h4l5 5v-6.59l4.45 4.45c-.69.52-1.47.93-2.32 1.18v2.06c1.39-.31 2.67-.95 3.77-1.82l1.69 1.69a.996.996 0 101.41-1.41L5.05 3.63a.996.996 0 00-1.42 0zM12 4L9.91 6.09 12 8.18V4zm6.5 8c0-1.77-1.02-3.29-2.5-4.03v1.79l2.48 2.48c.01-.08.02-.16.02-.24zm2.5 0c0 1.22-.26 2.37-.72 3.42l1.54 1.54c.73-1.44 1.18-3.07 1.18-4.96 0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71z"/>
          </svg>
        </button>
        <input
          type="text"
          id="chatInput"
          class="chat-input"
          placeholder="发送弹幕..."
          maxlength="100"
          autocomplete="off"
        />
        <button id="sendBtn" class="send-btn">发送</button>
      </div>
    </div>

    <!-- 右侧：聊天区域 -->
    <aside class="chat-panel">
      <div class="chat-header">
        <h3>实时聊天</h3>
        <div class="header-right">
          <span class="voice-indicator" id="voiceIndicator" title="正在语音的用户"></span>
          <span class="viewer-count" id="viewerCount">0 人在线</span>
        </div>
      </div>
      <div class="my-nickname" id="myNickname">
        <span>我的昵称：</span>
        <span class="nickname-text" id="nicknameText"></span>
        <button class="edit-nickname-btn" id="editNicknameBtn" title="修改昵称">
          <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor">
            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
          </svg>
        </button>
      </div>
      <!-- 语音用户列表 -->
      <div class="voice-users" id="voiceUsers"></div>
      <div class="chat-messages" id="chatMessages">
        <!-- 消息会动态插入这里 -->
      </div>
    </aside>
  </main>

  <!-- 修改昵称弹窗 -->
  <div class="nickname-modal" id="nicknameModal">
    <div class="nickname-dialog">
      <h4>修改昵称</h4>
      <input type="text" id="nicknameInput" maxlength="20" placeholder="输入新昵称">
      <div class="nickname-actions">
        <button class="nickname-cancel" id="nicknameCancel">取消</button>
        <button class="nickname-confirm" id="nicknameConfirm">确认</button>
      </div>
    </div>
  </div>

  <!-- 模块化 JS -->
  <script src="<%= url_for('js/live/state.js') %>"></script>
  <script src="<%= url_for('js/live/socket.js') %>"></script>
  <script src="<%= url_for('js/live/danmaku.js') %>"></script>
  <script src="<%= url_for('js/live/chat.js') %>"></script>
  <script src="<%= url_for('js/live/video.js') %>"></script>
  <script src="<%= url_for('js/live/voice.js') %>"></script>
  <script src="<%= url_for('js/live/admin.js') %>"></script>
  <script src="<%= url_for('js/live/index.js') %>"></script>
</body>
</html>
