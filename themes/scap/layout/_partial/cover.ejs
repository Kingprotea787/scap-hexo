<script src="/js/like.js?v=2" defer></script>

<div class="cover-flow-wrapper">
  <ul class="cover-flow">
    <li class="placeholder"></li><li class="placeholder"></li><li class="placeholder"></li>
    <% cards.forEach(function(card, idx){ %>
      <li
        data-like-id="<%= (card.link || card.title || ('card-' + idx)) %>"
        data-title="<%= card.title || '' %>"
        data-description="<%= card.description || '' %>"
        data-link="<%= card.link || '' %>"
        data-tags="<%= card.tags || '' %>"
        data-meta="<%= card.meta || '' %>"
        data-src="<%= card.video || '' %>">
        <img src="<%= card.img %>" alt="<%= card.alt || '' %>">
        <div class="play-button"></div>
      </li>
    <% }) %>
    <li class="placeholder"></li><li class="placeholder"></li><li class="placeholder"></li>
  </ul>
</div>

<%
  // 设定默认居中卡片索引（第5张=索引4），并对长度不足做兜底
  const initialIndex = 4;
  const safeIndex = (cards && cards.length && cards.length > initialIndex) ? initialIndex : 0;
  const initial = (cards && cards.length) ? cards[safeIndex] : null;
  const initialLikeId = initial ? (initial.link || initial.title || ('card-' + safeIndex)) : 'home';
%>

<div class="selected-description"
     data-post-id="<%= initialLikeId %>">
  <div class="post-header"><%= initial ? (initial.title || '') : '' %></div>

  <div class="post-user">
    <div class="post-user-left">
      <div class="post-user-logo">V</div>
      <div class="post-user-name">SCAP Hub</div>
    </div>

    <div class="post-actions">
      <button type="button" class="like-btn" aria-pressed="false">
        <svg class="icon" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" aria-hidden="true">
          <path d="M2 21h4V9H2v12zm20-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L13.17 2 
                  6.59 8.59C6.22 8.95 6 9.45 6 10v9c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05
                  c.09-.23.14-.47.14-.73v-2z"/>
        </svg> 
        <span class="like-count">0</span>
      </button>
      <button type="button" class="share-btn">
        <svg class="icon" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" aria-hidden="true">
          <path d="M14 3v2h3.59L10 12.59 11.41 14 19 6.41V10h2V3h-7zM5 5c-1.1
                  0-2 .9-2 2v12c0 1.1.9 2 2 2h14c1.1 0 2-.9
                  2-2v-5h-2v5H5V7h5V5H5z"/>
        </svg>
        分享</button>
      <button type="button" class="more-btn">⋯</button>
    </div>
  </div>

  <div class="post-meta"><%= initial ? (initial.meta || '') : '' %></div>
  <div class="post-content"><%= initial ? (initial.description || '') : '' %></div>
  <a class="post-link" href="<%= initial ? (initial.link || '#') : '#' %>">
    <%= initial ? (initial.link || '') : '' %>
  </a>
  <div class="post-tags"><%= initial ? (initial.tags || '') : '' %></div>
</div>

<link rel="stylesheet" href="<%= url_for('css/videoplay.css') %>">
<link rel="stylesheet" href="<%= url_for('css/coverflow.css') %>">
<link rel="stylesheet" href="<%= url_for('css/videodesc.css') %>">
<script src="<%= url_for('js/cover.js') %>"></script>
